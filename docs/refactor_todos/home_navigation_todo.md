# 首页导航与入口模块重构 TODO

## UniApp 现状
- 主页：`pages/index.nvue`，负责展示功能入口、通知、消息、快捷操作。
- 需根据角色展示不同菜单，并跳转到各业务模块。

## Flutter 现状
- 已实现 `WMSHomePage`，包含顶部背景、通知快捷入口、功能网格等基本布局。【F:lib/modules/home/home_page.dart†L1-L200】
- 功能入口、消息跳转、角色权限控制尚需补全。

## Flutter 重构策略
- **菜单配置**：
  - 将 UniApp `pages/index.nvue` 中的菜单配置转化为 Flutter `enum`/`model` + JSON 配置，支持按角色/权限筛选。
  - 功能入口点击后通过 `Modular.to.pushNamed` 跳转至重构后的模块路由。
- **通知与消息**：
  - 复用消息中心、异常监控模块提供的数据，显示未读 badge、最新公告。
  - 通知区使用 `NotificationItem` 模型，接入真实数据源而非占位文案。
- **UI 扩展**：
  - 保持现有视觉风格，完善功能网格、最近使用、常用工具等区域。
  - 支持在首页显示待办数量、快捷入口排序。
- **状态管理**：
  - 引入 `HomeCubit` 管理首页数据（公告、未读消息、快捷入口、角色信息）。
  - 与 `UserManager` 同步用户信息，动态刷新权限菜单。

## 待办清单
1. 从 UniApp 首页抽取功能菜单、权限逻辑，转换为 Flutter 配置文件或后端下发格式。
2. 实现 `HomeCubit`：
   - 加载公告（调用 `MessageService.getLatestNotice`）。
   - 加载未读消息/异常数量（调用异常监控模块服务）。
   - 组合功能入口列表（依赖用户角色、常用菜单）。
3. 更新 `WMSHomePage`：
   - 将通知区、功能网格的数据绑定到 `HomeCubit`。
   - 为各入口绑定 Flutter 路由（如 `/outbound/list`、`/goods-up/list` 等）。
   - 实现退出登录、账号信息展示。
4. 若需多角色布局：
   - 支持根据角色切换菜单模板，或在服务端配置。
5. 测试：
   - Cubit 测试覆盖菜单加载、公告加载、权限变化场景。
   - UI 测试验证入口跳转正确。
6. 文档：
   - 更新首页导航配置说明、权限控制策略、数据来源。
